{
  "task": "Refactor DashboardNew.tsx (1280+ lines) into modular components",
  "context": {
    "project": "dream-api - API-as-a-Service platform",
    "current_file": "frontend/src/pages/DashboardNew.tsx",
    "lines": 1491,
    "structure": {
      "lines_1_50": "Imports, types, constants",
      "lines_50_130": "State declarations & useEffects",
      "lines_130_250": "API functions (loadProjects, loadCredentials, loadDashboard)",
      "lines_250_330": "Action handlers (deleteProject, regenerateSecret)",
      "lines_330_400": "Early returns (loading, no projects)",
      "lines_400_520": "Project selector bar & delete confirmation",
      "lines_520_630": "API Keys section",
      "lines_630_810": "SaaS view (metrics, tiers, customers)",
      "lines_810_1000": "Store view (products, orders)",
      "lines_1000_1110": "Webhook status, modals, toasts",
      "lines_1110_1280": "Helper components (Header, MetricCard, etc.)",
      "lines_1280_1491": "TotalsView and remaining helpers"
    }
  },
  "target_structure": {
    "root": "frontend/src/",
    "new_files": [
      "constants/index.ts",
      "hooks/useProjects.ts",
      "hooks/useDashboardData.ts",
      "hooks/useCredentials.ts",
      "hooks/useToast.ts",
      "components/layout/Header.tsx",
      "components/layout/ProjectSelector.tsx",
      "components/dashboard/ApiKeysSection.tsx",
      "components/dashboard/StripeAccountSection.tsx",
      "components/dashboard/SaasDashboard.tsx",
      "components/dashboard/StoreDashboard.tsx",
      "components/dashboard/CustomerTable.tsx",
      "components/dashboard/MetricsCards.tsx",
      "components/dashboard/DeleteConfirmModal.tsx",
      "components/shared/Badge.tsx",
      "components/shared/CopyButton.tsx",
      "components/shared/LoadingSpinner.tsx",
      "components/shared/MetricCard.tsx",
      "components/shared/UsageBar.tsx",
      "components/shared/StatusBadge.tsx",
      "utils/logger.ts",
      "utils/api.ts",
      "pages/DashboardNew.tsx (refactored to ~200 lines)"
    ]
  },
  "extraction_rules": {
    "constants": {
      "extract": ["API_MULTI", "FRONT_AUTH_API", "'saas'", "'store'", "'test'", "'live'", "'free'", "'pro'", "'developer'"],
      "destination": "constants/index.ts",
      "format": "export const API_URLS = { API_MULTI: '...', FRONT_AUTH_API: '...' } as const;"
    },
    "hooks": {
      "useProjects": {
        "extract_from": "lines 171-252",
        "includes": ["loadProjects()", "loadCredentials()", "generatePlatformId()", "handlePayment()"],
        "returns": "{ projects, loading, error, refresh }"
      },
      "useDashboardData": {
        "extract_from": "lines 254-292",
        "includes": ["loadDashboard()", "loadProducts()"],
        "returns": "{ dashboard, products, loadingDashboard, refresh }"
      },
      "useCredentials": {
        "extract_from": "state and related logic",
        "includes": ["credentials state", "secret key management"],
        "returns": "{ credentials, showSecret, toggleSecret, copyKey }"
      }
    },
    "components": {
      "ApiKeysSection": {
        "lines": "621-737",
        "props": "{ project: Project, credentials: Credentials, onRegenerate: () => void, onCopy: (text: string) => void }",
        "imports": ["useState from 'react'", "constants from '@/constants'"]
      },
      "StripeAccountSection": {
        "lines": "745-786",
        "props": "{ stripeAccountId: string | null, onCopy: (text: string) => void }",
        "notes": "Handles both connected and not-connected states"
      },
      "SaasDashboard": {
        "lines": "815-890",
        "props": "{ metrics: any, tiers: any[], customers: any[], onEditTiers: () => void, onCopy: (text: string) => void }",
        "includes": ["MetricsCards", "CustomerTable", "tier display"]
      },
      "StoreDashboard": {
        "lines": "895-1110",
        "props": "{ products: any[], webhook: any, onCopy: (text: string) => void }",
        "includes": ["Product grid", "Orders table"]
      },
      "ProjectSelector": {
        "lines": "478-573",
        "props": "{ projects: Project[], selectedPk: string | null, onSelect: (pk: string) => void, onDelete: () => void, onRefresh: () => void }",
        "includes": ["Project dropdown", "type/mode badges", "action buttons"]
      }
    },
    "shared_components": {
      "MetricCard": {
        "lines": "1338-1346",
        "props": "{ label: string, value: string | number }",
        "destination": "components/shared/MetricCard.tsx"
      },
      "UsageBar": {
        "lines": "1348-1365",
        "props": "{ count: number, limit: number | string }",
        "destination": "components/shared/UsageBar.tsx"
      },
      "StatusBadge": {
        "lines": "1367-1380",
        "props": "{ status: string }",
        "destination": "components/shared/StatusBadge.tsx"
      },
      "Header": {
        "lines": "1313-1323",
        "props": "{}",
        "destination": "components/layout/Header.tsx"
      }
    }
  },
  "implementation_phases": {
    "phase_1": {
      "name": "Foundation",
      "steps": [
        "Create constants/index.ts with all magic strings",
        "Create utils/logger.ts with structured logging",
        "Create utils/api.ts with ApiClient class",
        "Update package.json with test scripts"
      ],
      "validation": "All hardcoded strings replaced with constants"
    },
    "phase_2": {
      "name": "Hooks Extraction",
      "steps": [
        "Create hooks/useProjects.ts from lines 171-252",
        "Create hooks/useDashboardData.ts from lines 254-292",
        "Create hooks/useCredentials.ts from credential logic",
        "Write basic tests for each hook"
      ],
      "validation": "DashboardNew.tsx no longer contains API functions"
    },
    "phase_3": {
      "name": "Component Extraction",
      "order": [
        "components/shared/MetricCard.tsx",
        "components/shared/UsageBar.tsx",
        "components/shared/StatusBadge.tsx",
        "components/layout/Header.tsx",
        "components/dashboard/ApiKeysSection.tsx",
        "components/dashboard/StripeAccountSection.tsx",
        "components/dashboard/ProjectSelector.tsx",
        "components/dashboard/SaasDashboard.tsx",
        "components/dashboard/StoreDashboard.tsx"
      ],
      "validation": "Each component < 200 lines, has proper TypeScript types"
    },
    "phase_4": {
      "name": "Dashboard Refactoring",
      "steps": [
        "Update DashboardNew.tsx to import hooks and components",
        "Remove extracted code (keep only ~200 lines of orchestration)",
        "Add error boundaries",
        "Add environment validation"
      ],
      "validation": "DashboardNew.tsx < 250 lines, compiles without errors"
    }
  },
  "coding_conventions": {
    "imports": "Use '@/path' alias for imports",
    "types": "All props must have TypeScript interfaces",
    "naming": "PascalCase for components, camelCase for functions",
    "constants": "UPPER_SNAKE_CASE for constants",
    "error_handling": "Use try/catch with proper error logging",
    "comments": "Keep existing comments, add JSDoc for new functions"
  },
  "testing_requirements": {
    "unit_tests": "Each hook and component should have basic tests",
    "test_files": "Create __tests__/ directory with matching structure",
    "coverage": "Aim for 80%+ test coverage on new code",
    "tools": "Use Vitest + Testing Library"
  },
  "deliverables": {
    "must_have": [
      "Working refactored DashboardNew.tsx (< 250 lines)",
      "All extracted components in proper directories",
      "Constants file eliminating magic strings",
      "Basic API client utility",
      "Structured logging utility"
    ],
    "nice_to_have": [
      "Unit tests for extracted components",
      "Error boundaries implementation",
      "Environment validation at startup",
      "TypeScript strict mode enabled"
    ]
  },
  "success_criteria": {
    "code_quality": "No TypeScript errors, ESLint passes",
    "performance": "No regression in dashboard load time",
    "maintainability": "Each component does one thing, < 200 lines",
    "testability": "Components can be tested in isolation",
    "developer_experience": "New dev can understand structure in < 1 hour"
  }
}
name = "api-multi"
main = "src/index.ts"
compatibility_date = "2024-11-01"

# TOKENS_KV: Stores tier configs for fast limit lookups
# - platform:{platformId}:tierConfig → {tiers: [...]} (COPIED from front-auth-api)
# - publishablekey:{pk_live_xyz}:platformId → plt_abc123 (reverse lookup)
# - secretkey:{hash}:publishableKey → pk_live_xyz789 (API auth)
# Cloudflare name: api-multi-TOKENS_KV
[[kv_namespaces]]
binding = "TOKENS_KV"
id = "a9f3331b0c8b48d58c32896482484208"
preview_id = "a9f3331b0c8b48d58c32896482484208"

[[d1_databases]]
binding = "DB"
database_name = "dream-api-ssot"
database_id = "07e784d5-2c3f-4bb0-a79c-094c1d05410f"

# Optional: R2 bucket for hosted product images
[[r2_buckets]]
binding = "dream_api_assets"
bucket_name = "dream-api-assets"
preview_bucket_name = "dream-api-assets"

[vars]
# Non-secret variables
# Clerk JWT template name (create in Clerk dashboard)
CLERK_JWT_TEMPLATE = "end-user-api"
# CORS allowed origins
ALLOWED_ORIGINS = "http://localhost:5173,http://localhost:5174,http://localhost:3000,http://localhost:8787,http://127.0.0.1:5500,http://localhost:5500,https://dream-frontend-dyn.pages.dev"

# Local development settings
[dev]
port = 8787

# Observability - Logging
[observability]
[observability.logs]
enabled = true
head_sampling_rate = 1
invocation_logs = true
persist = true
